syntax = "proto3";

package EcdarProtoBuf;

option java_multiple_files = false;
option java_package = "EcdarProtoBuf";
option java_outer_classname = "QueryProtos";

import "component.proto";
import "objects.proto";

message IgnoredInputOutputs {
  repeated string ignored_inputs = 1;
  repeated string ignored_outputs = 2;
}


message UserTokenResponse {
  int32 user_id = 1;
}

message QueryRequest {
  int32 user_id = 1;
  int32 query_id = 2;
  string query = 3;
  ComponentsInfo components_info = 4;
  IgnoredInputOutputs ignored_input_outputs = 5;

  message Settings {
    bool should_reduce_clocks = 1;
  }

  Settings settings = 6;
}

message QueryResponse { 
  oneof response {
    QueryOk query_ok = 1;
    UserTokenError user_token_error = 2;  
  }

  message QueryOk {
    int32 query_id = 1;

    message RefinementResult {
      bool success = 1;
      repeated State relation = 2;
      string reason = 3;
      State state = 4;
    }

    message ComponentResult { Component component = 1; }
    message ConsistencyResult {
      bool success = 1;
      string reason = 2;
      State state = 3;
    }
    message DeterminismResult {
      bool success = 1;
      string reason = 2;
      State state = 3;
    }
    message ImplementationResult {
      bool success = 1;
      string reason = 2;
      State state = 3;
    }
    message ReachabilityResult {
      bool success = 1;
      string reason = 2;
      State state = 3;
      repeated Edge edges = 4;
    }

    oneof result {
      RefinementResult refinement = 3;
      ComponentResult component = 4;
      ConsistencyResult consistency = 5;
      DeterminismResult determinism = 6;
      string error = 7;
      ImplementationResult implementation = 8;
      ReachabilityResult reachability = 9;
    }
    message Information {
      string subject = 1;
      string message = 2;
    }
    repeated Information info = 10;
  }
}

message UserTokenError {
  int32 user_id = 1;
  string error_message = 2;
}

message SimulationStartRequest {
  SimulationInfo simulation_info = 1;
}

message SimulationStepRequest {
  SimulationInfo simulation_info = 1;
  Decision chosen_decision = 2;
}

message SimulationStepResponse {
  DecisionPoint new_decision_point = 1;
}

message SimulationInfo {
  string component_composition = 2; // example: A || B || A
  ComponentsInfo components_info = 3;
}
